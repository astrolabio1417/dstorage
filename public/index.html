<!doctype html>
<html lang="en" data-theme="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Discord Storage</title>
  <meta name="color-scheme" content="light dark" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap" rel="stylesheet" />

  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />
</head>

<body class="bg-gray-700 text-white">
  <main class="flex gap-2 h-screen overflow-hidden">
    <div class="w-full max-w-[120px] border-right p-1">
      <h1 class="p-2 font-bold">DStorage</h1>

      <div class="my-5 w-full flex flex-col gap-2">
        <a class="rounded bg-gray-800 px-2 py-2 w-full" href="/">Home</a>
      </div>
    </div>
    <div class="border-l border-white/25 w-full h-full flex flex-col">
      <!-- body top  -->
      <!-- <div class="grid gap-2 border-b-1 h-9">
          <div class="flex">
            <a class="rounded bg-gray-800 px-5 flex items-center" href="/">Home</a>
          </div>
        </div> -->
      <!-- body -->

      <div class="overflow-auto h-full">
        <div class="p-2 gap-2 text-xs text-center flex flex-wrap justify-center gap-2" id="nodes"></div>
      </div>
    </div>
  </main>

  <div class="fixed bottom-5 right-5 flex flex-col gap-2 items-center justify-center">
    <!-- new folder button -->
    <button id="t-folder-btn"
      class="modal-toggle-btn w-9 h-9 flex justify-center items-center cursor-pointer hover:scale-110">
      <svg fill="#ffffff" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 598.466 598.466" xml:space="preserve" stroke="#ffffff">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
          <g>
            <g>
              <path
                d="M58.64,500.586h211.267c4.544,6.361,9.623,12.359,15.221,17.958c13.026,13.026,28.207,23.258,45.118,30.411 c17.532,7.416,36.132,11.175,55.28,11.175c19.149,0,37.748-3.76,55.28-11.175c16.912-7.153,32.092-17.385,45.118-30.411 c5.599-5.599,10.677-11.597,15.221-17.958h38.681c32.059,0,58.141-26.082,58.141-58.141V142.566 c0-32.059-26.082-58.14-58.141-58.14H323.819l-10.096-17.28c-5.115-8.755-12.467-16.05-21.261-21.097 c-8.793-5.046-18.8-7.714-28.939-7.714H58.64c-32.059,0-58.14,26.082-58.14,58.14v30.791v298.165v17.015 C0.5,474.504,26.582,500.586,58.64,500.586z M440.611,500.586c-15.756,10.549-34.701,16.704-55.086,16.704 c-20.386,0-39.331-6.155-55.087-16.704c-15.683-10.501-28.199-25.357-35.825-42.84c-5.292-12.13-8.233-25.521-8.233-39.6 c0-54.756,44.389-99.145,99.145-99.145c54.755,0,99.144,44.389,99.144,99.145c0,14.079-2.941,27.47-8.231,39.6 C468.812,475.228,456.296,490.085,440.611,500.586z M43.34,425.431V127.266V96.475c0-8.45,6.85-15.3,15.3-15.3h204.883 c5.438,0,10.468,2.886,13.21,7.582l18.068,30.927c2.743,4.695,7.773,7.582,13.21,7.582h231.812c8.45,0,15.3,6.85,15.3,15.3 v299.879c0,8.45-6.85,15.301-15.3,15.301H521.9c3.721-12.805,5.608-26.063,5.608-39.6c0-19.149-3.76-37.748-11.175-55.279 c-7.153-16.913-17.385-32.093-30.411-45.118c-13.025-13.026-28.206-23.258-45.118-30.411 c-17.531-7.416-36.131-11.175-55.279-11.175c-19.149,0-37.748,3.76-55.28,11.175c-16.912,7.153-32.092,17.385-45.118,30.411 c-13.026,13.025-23.257,28.206-30.411,45.118c-7.416,17.531-11.175,36.13-11.175,55.279c0,13.536,1.888,26.795,5.609,39.6H58.64 c-8.45,0-15.3-6.851-15.3-15.301V425.431z">
              </path>
              <path
                d="M385.525,560.63c-19.219,0-37.883-3.773-55.475-11.214c-16.974-7.18-32.207-17.447-45.277-30.519 c-5.518-5.519-10.605-11.51-15.124-17.812H58.64C26.306,501.086,0,474.781,0,442.446V96.475c0-32.334,26.306-58.64,58.64-58.64 h204.883c10.227,0,20.32,2.69,29.188,7.78c8.869,5.091,16.284,12.449,21.443,21.278l9.951,17.032h215.719 c32.335,0,58.641,26.306,58.641,58.64v299.879c0,32.335-26.306,58.641-58.641,58.641h-38.424 c-4.52,6.304-9.607,12.295-15.124,17.812c-13.071,13.071-28.305,23.34-45.277,30.519 C423.406,556.857,404.741,560.63,385.525,560.63z M58.64,38.835C26.857,38.835,1,64.692,1,96.475v345.971 c0,31.783,25.857,57.641,57.64,57.641h211.524l0.149,0.209c4.524,6.334,9.627,12.354,15.167,17.896 c12.979,12.979,28.105,23.175,44.958,30.305c17.469,7.389,36.002,11.135,55.086,11.135c19.082,0,37.615-3.746,55.086-11.136 c16.853-7.128,31.979-17.323,44.959-30.304c5.539-5.539,10.642-11.56,15.167-17.896l0.15-0.209h38.938 c31.783,0,57.641-25.857,57.641-57.641V142.566c0-31.783-25.857-57.64-57.641-57.64H323.532l-10.24-17.528 c-5.071-8.679-12.36-15.912-21.078-20.916c-8.717-5.003-18.638-7.647-28.69-7.647H58.64z M385.525,517.791 c-19.815,0-38.96-5.806-55.365-16.789c-15.917-10.658-28.367-25.546-36.005-43.055c-5.49-12.587-8.274-25.978-8.274-39.8 c0-54.944,44.7-99.645,99.645-99.645c54.943,0,99.644,44.7,99.644,99.645c0,13.821-2.783,27.212-8.273,39.8 c-7.639,17.511-20.089,32.398-36.006,43.055C424.484,511.985,405.34,517.791,385.525,517.791z M385.525,319.502 c-54.393,0-98.645,44.252-98.645,98.645c0,13.685,2.756,26.94,8.191,39.399c7.561,17.334,19.886,32.073,35.645,42.625 c16.239,10.872,35.192,16.619,54.809,16.619s38.568-5.747,54.808-16.619c15.758-10.551,28.084-25.29,35.646-42.625 c5.434-12.46,8.189-25.717,8.189-39.399C484.169,363.754,439.918,319.502,385.525,319.502z M539.824,458.247h-18.59l0.186-0.64 c3.709-12.762,5.589-26.038,5.589-39.46c0-19.082-3.746-37.615-11.136-55.085c-7.128-16.854-17.323-31.979-30.304-44.959 c-12.979-12.979-28.105-23.175-44.959-30.304c-17.469-7.389-36.002-11.135-55.085-11.135c-19.082,0-37.615,3.747-55.086,11.135 c-16.853,7.128-31.979,17.325-44.959,30.304c-12.979,12.979-23.175,28.105-30.304,44.959 c-7.389,17.469-11.136,36.001-11.136,55.085c0,13.421,1.88,26.697,5.589,39.46l0.186,0.64H58.64c-8.712,0-15.8-7.088-15.8-15.801 V96.475c0-8.712,7.088-15.8,15.8-15.8h204.883c5.594,0,10.821,3,13.642,7.83l18.068,30.926c2.643,4.524,7.54,7.334,12.779,7.334 h231.812c8.712,0,15.8,7.088,15.8,15.8v299.879C555.624,451.159,548.536,458.247,539.824,458.247z M522.564,457.247h17.26 c8.16,0,14.8-6.64,14.8-14.801V142.566c0-8.161-6.64-14.8-14.8-14.8H308.013c-5.594,0-10.821-3-13.642-7.83L276.302,89.01 c-2.643-4.524-7.539-7.334-12.779-7.334H58.64c-8.161,0-14.8,6.639-14.8,14.8v345.971c0,8.161,6.639,14.801,14.8,14.801h189.845 c-3.613-12.657-5.444-25.809-5.444-39.1c0-19.218,3.773-37.882,11.215-55.474c7.179-16.974,17.447-32.207,30.518-45.277 c13.071-13.071,28.305-23.339,45.277-30.518c17.594-7.441,36.259-11.214,55.475-11.214c19.218,0,37.882,3.773,55.474,11.214 c16.974,7.179,32.207,17.447,45.277,30.518c13.071,13.07,23.34,28.304,30.519,45.277c7.44,17.593,11.214,36.257,11.214,55.474 C528.009,431.439,526.177,444.59,522.564,457.247z">
              </path>
            </g>
            <g>
              <path
                d="M433.873,396.727h-26.928v-26.929c0-11.829-9.59-21.42-21.42-21.42s-21.42,9.591-21.42,21.42v26.929h-26.929 c-11.83,0-21.42,9.59-21.42,21.42s9.59,21.42,21.42,21.42h26.929v18.18v8.748c0,11.83,9.59,21.42,21.42,21.42 s21.42-9.59,21.42-21.42v-8.748v-18.18h26.928c11.83,0,21.42-9.59,21.42-21.42S445.703,396.727,433.873,396.727z">
              </path>
              <path
                d="M385.525,488.415c-12.087,0-21.92-9.833-21.92-21.92v-26.428h-26.429c-12.087,0-21.92-9.833-21.92-21.92 s9.833-21.92,21.92-21.92h26.429v-26.429c0-12.087,9.833-21.92,21.92-21.92s21.92,9.833,21.92,21.92v26.429h26.428 c12.087,0,21.92,9.833,21.92,21.92s-9.833,21.92-21.92,21.92h-26.428v26.428C407.445,478.582,397.612,488.415,385.525,488.415z M337.177,397.227c-11.535,0-20.92,9.385-20.92,20.92s9.385,20.92,20.92,20.92h27.429v27.428c0,11.535,9.385,20.92,20.92,20.92 s20.92-9.385,20.92-20.92v-27.428h27.428c11.535,0,20.92-9.385,20.92-20.92s-9.385-20.92-20.92-20.92h-27.428v-27.429 c0-11.535-9.385-20.92-20.92-20.92s-20.92,9.385-20.92,20.92v27.429H337.177z">
              </path>
            </g>
          </g>
        </g>
      </svg>
    </button>

    <!-- upload button -->
    <button id="t-file-btn"
      class="modal-toggle-btn w-10 h-10 flex justify-center items-center cursor-pointer hover:scale-110">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
          <path d="M12 8L12 16" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          <path d="M15 11L12.087 8.08704V8.08704C12.039 8.03897 11.961 8.03897 11.913 8.08704V8.08704L9 11"
            stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          <path d="M3 15L3 16L3 19C3 20.1046 3.89543 21 5 21L19 21C20.1046 21 21 20.1046 21 19L21 16L21 15"
            stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </g>
      </svg>
    </button>
  </div>

  <div id="modal" class="hidden fixed inset-0 flex justify-center items-center text-white bg-black/75">
    <div class="bg-gray-700 w-xl max-h-full m-1 p-1 rounded overflow-hidden overflow-y-auto">
      <button class="w-4 h-4 place-self-end-safe modal-toggle-btn cursor-pointer hover:scale-110">
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" fill="#000000">
          <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
          <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
          <g id="SVGRepo_iconCarrier">
            <path fill="#ffffff"
              d="M195.2 195.2a64 64 0 0 1 90.496 0L512 421.504 738.304 195.2a64 64 0 0 1 90.496 90.496L602.496 512 828.8 738.304a64 64 0 0 1-90.496 90.496L512 602.496 285.696 828.8a64 64 0 0 1-90.496-90.496L421.504 512 195.2 285.696a64 64 0 0 1 0-90.496z">
            </path>
          </g>
        </svg>
      </button>

      <form id="t-file-form" class="flex gap-2 py-5 items-center flex-col" method="post" enctype="multipart/form-data">
        <label for="files">
          <svg width="4em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
            <g id="SVGRepo_iconCarrier">
              <path d="M12 8L12 16" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              </path>
              <path d="M15 11L12.087 8.08704V8.08704C12.039 8.03897 11.961 8.03897 11.913 8.08704V8.08704L9 11"
                stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
              <path d="M3 15L3 16L3 19C3 20.1046 3.89543 21 5 21L19 21C20.1046 21 21 20.1046 21 19L21 16L21 15"
                stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </g>
          </svg>
        </label>

        <label for="files" class="font-bold"> Upload File </label>

        <label id="filename" for="files" class="text-center">No file chosen</label>

        <input class="hidden" type="file" id="files" name="files" accept=".mp4" />

        <p id="percent"></p>

        <input disabled class="rounded bg-gray-800 max-w-xs py-2 w-full cursor-pointer disabled:cursor-not-allowed"
          id="submit" type="submit" value="Upload" />
      </form>

      <form id="t-folder-form" class="flex gap-2 py-5 items-center flex-col" id="folder-submit-form" method="post">
        <input class="p-2 border rounded-sm w-full max-w-xs" required type="text" name="name"
          placeholder="Folder Name" />
        <input hidden class="p-2 border rounded-sm w-full max-w-xs" type="text" name="parent" placeholder="Parent" />
        <input class="rounded bg-gray-800 max-w-xs py-2 w-full cursor-pointer disabled:cursor-not-allowed" id="submit"
          type="submit" value="Create Folder" />
      </form>
    </div>
  </div>

  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

  <script type="text/javascript" src="/uploader.js"></script>



  <script type="text/javascript">

    const folder = `<svg  height="7em" fill="white" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M2.8 5H1v16h22V5H12.2L11 3H4zM22 20H2V9h20zM10.434 4l1.2 2H22v2H2V6h1.366l1.2-2z"></path><path fill="none" d="M0 0h24v24H0z"></path></g></svg>`

    const file = `<svg height="7em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC" stroke-width="0.24000000000000005"></g><g id="SVGRepo_iconCarrier"> <path d="M19 9V17.8C19 18.9201 19 19.4802 18.782 19.908C18.5903 20.2843 18.2843 20.5903 17.908 20.782C17.4802 21 16.9201 21 15.8 21H8.2C7.07989 21 6.51984 21 6.09202 20.782C5.71569 20.5903 5.40973 20.2843 5.21799 19.908C5 19.4802 5 18.9201 5 17.8V6.2C5 5.07989 5 4.51984 5.21799 4.09202C5.40973 3.71569 5.71569 3.40973 6.09202 3.21799C6.51984 3 7.0799 3 8.2 3H13M19 9L13 3M19 9H14C13.4477 9 13 8.55228 13 8V3" stroke="#ffffff" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>`

    window.addEventListener('load', () => {
      loadNodes()
    })

    async function getNodes() {
      const u = new URL(`${window.location.origin}/api/nodes`)
      const parent = new URLSearchParams(window.location.search).get('parent')

      if (parent) {
        u.searchParams.set('parent', parent)
      }

      const res = await fetch(u.toString())
      if (!res.ok) return null
      return res.json()
    }

    function setFolderList(nodes) {
      const nodesDiv = document.querySelector('div#nodes')
      nodesDiv.innerHTML = ''

      if (!nodes?.length) {
        const p = document.createElement('p')
        p.classList = 'font-bold italic text-xl my-12'
        p.innerHTML = 'Folder is Empty'
        nodesDiv.appendChild(p)
      }

      nodes.map((node) => {
        const isFolder = node.type === 'FOLDER'
        const nodeDiv = document.createElement('div')
        nodeDiv.title = node.name
        nodeDiv.className = 'flex flex-col max-w-[7em]'
        const nodeLink = document.createElement('a')
        const isVideo = node.name.endsWith('.mp4')
        nodeLink.href = isFolder
          ? getNextFolder(node.id)
          : isVideo
            ? `/video.html?url=${window.location.origin}/api/nodes/${node.id}/download`
            : `/api/nodes/${node.id}/download`
        const nodePar = document.createElement('p')
        nodeLink.innerHTML = isFolder ? folder : file
        nodePar.classList = 'text-nowrap overflow-hidden'
        nodePar.innerHTML = node.name
        nodeLink.append(nodePar)
        nodeDiv.appendChild(nodeLink)
        nodesDiv.appendChild(nodeDiv)
      })
    }

    function getNextFolder(nodeId) {
      const parentIds = new Set((new URLSearchParams(window.location.search).get('parentsId') || '').split(','))
      parentIds.delete('')
      return `/?parent=${nodeId}&parentsId=${[...Array.from(parentIds), nodeId].join(',')}`
    }

    function loadNodes() {
      getNodes().then((data) => {
        setFolderList(data ?? [])
      })
    }
  </script>
</body>

</html>